<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Fluig - Aprova√ß√£o Gerencial</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --text-color: #333;
            --light-gray: #f8f9fa;
            --border-color: #dee2e6;
            --header-bg: #fff;
            --table-header-bg: #e9ecef;
            --shadow: 0 2px 4px rgba(0,0,0,0.05);
            --red-alert: #dc3545;
            --green-success: #28a745;
            --orange-warning: #ffc107;
            --colombia-bg: #e6f7ff;
            --hongkong-bg: #fff3e0;
            --colombia-border: #90cdf4;
            --hongkong-border: #ffcc80;
            --highlight-bg: #e0f7fa; /* Light blue for highlights */
            --highlight-border: #00bcd4; /* Cyan for highlight borders */
            --dark-blue: #004085; /* Darker blue for key text */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
        }

        body {
            background-color: var(--light-gray);
            line-height: 1.6;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .page {
            display: none;
            width: 100%;
            flex-grow: 1;
        }

        .page.active {
            display: flex;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }

        .header {
            background-color: var(--header-bg);
            padding: 15px 40px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .header h1 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 13px;
            color: #666;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-icon {
            background-color: #e0e0e0;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            flex-shrink: 0;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            white-space: nowrap;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }

        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group input[type="number"],
        .input-group input[type="file"],
        .input-group select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s ease-in-out;
        }

        .input-group input:focus,
        .input-group select:focus,
        textarea:focus {
            border-color: var(--primary-color);
        }

        .icon-user::before { content: 'üë§'; }
        .icon-lock::before { content: 'üîí'; }
        .icon-search::before { content: 'üîç'; }
        .icon-plus::before { content: '‚ûï'; }
        .icon-question::before { content: '?'; }
        .icon-flow::before { content: '!'; } /* √çcone para o bot√£o Fluxo */


        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            flex-grow: 1;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
            flex-grow: 1;
            min-width: 150px;
        }

        .filter-group label {
            font-weight: 500;
            color: #555;
            font-size: 13px;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 14px;
            min-width: 120px;
        }

        .search-group {
            flex-grow: 2;
            display: flex;
            flex-direction: column;
            gap: 5px;
            min-width: 250px;
        }

        .search-input-wrapper {
            display: flex;
            width: 100%;
        }

        .search-group input {
            flex-grow: 1;
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        .search-icon-btn {
            background-color: transparent;
            border: 1px solid var(--border-color);
            border-left: none;
            border-radius: 0 5px 5px 0;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            color: #666;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            background-color: #fff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        table thead th {
            background-color: var(--table-header-bg);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            color: #555;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        table tbody td {
            padding: 10px 15px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
            vertical-align: middle;
            white-space: nowrap;
        }

        table tbody tr:hover {
            background-color: #f5f5f5;
        }

        .pedido-link {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .pedido-link:hover {
            text-decoration: underline;
        }

        .flag-icon {
            width: 16px;
            height: 11px;
            vertical-align: middle;
            margin-right: 5px;
            border: 1px solid #eee;
        }

        .footer-button {
            text-align: right;
            margin-top: 20px;
            padding: 10px 0;
        }

        .form-section {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab-button {
            background-color: transparent;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease-in-out;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 20px 0;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content h2 {
            font-size: 18px;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .tab-content p {
            font-size: 13px;
            color: #666;
            margin-bottom: 15px;
        }

        .accordion {
            border: 1px solid var(--border-color);
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .accordion-item {
            border-bottom: 1px solid var(--border-color);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            width: 100%;
            background-color: #f7f7f7;
            padding: 12px 15px;
            text-align: left;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease-in-out;
        }

        .accordion-header:hover {
            background-color: #ececec;
        }

        .accordion-header .arrow {
            transition: transform 0.2s ease-in-out;
        }

        .accordion-header.active .arrow {
            transform: rotate(180deg);
        }

        .accordion-content {
            padding: 15px;
            background-color: #fff;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .accordion-content.active {
            display: block;
        }

        #uploadPlanilhaInput,
        #copiarColarTextarea {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        .how-to-use-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .how-to-use-item {
            background-color: #f0f5fa;
            border: 1px dashed #cce0f0;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .how-to-use-item h4 {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .how-to-use-item p {
            font-size: 13px;
            color: #555;
            margin-bottom: 15px;
        }

        .how-to-use-item a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .how-to-use-item a:hover {
            text-decoration: underline;
        }

        .add-product-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #fefefe;
        }

        .add-product-grid .input-group {
            margin-bottom: 0;
        }

        .add-product-grid .input-group input[type="text"],
        .add-product-grid .input-group input[type="number"],
        .add-product-grid .input-group select {
            width: 100%;
        }

        .add-product-grid .input-group.full-width {
            grid-column: span 2;
        }

        .add-product-grid .input-group.search-input {
            display: flex;
            align-items: center;
        }
        .add-product-grid .input-group.search-input input {
            border-right: none;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        .add-product-grid .input-group.search-input button {
            border-left: none;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            padding: 10px 12px;
            height: 38px;
        }

        .add-button-container {
            grid-column: span 4;
            text-align: right;
            margin-top: 10px;
        }

        .products-added-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .products-added-section h3 {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        #noProductsMessage {
            text-align: center;
            color: #888;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: 5px;
        }

        #addedProductsTable {
            width: 100%;
            margin-top: 15px;
        }

        #addedProductsTable th,
        #addedProductsTable td {
            padding: 10px 8px;
            text-align: left;
            border: 1px solid #eee;
            font-size: 12px;
            word-wrap: break-word;
        }

        #addedProductsTable th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            text-transform: uppercase;
        }

        #addedProductsTable .remove-item-btn {
            background-color: var(--red-alert);
            color: #fff;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s ease-in-out;
        }

        #addedProductsTable .remove-item-btn:hover {
            background-color: #c82333;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .product-details {
            display: none;
        }

        .validation-message {
            color: var(--red-alert);
            font-size: 13px;
            margin-top: 10px;
            display: none;
        }

        .success-message {
            color: var(--green-success);
            font-size: 13px;
            margin-top: 10px;
            display: none;
        }

        .status-ok { color: var(--green-success); font-weight: bold; }
        .status-warning { color: var(--orange-warning); font-weight: bold; }
        .status-error { color: var(--red-alert); font-weight: bold; }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-indicator.green { background-color: var(--green-success); }
        .status-indicator.yellow { background-color: var(--orange-warning); }
        .status-indicator.red { background-color: var(--red-alert); }
        .status-indicator.blue { background-color: var(--primary-color); }
        .status-indicator.gray { background-color: var(--secondary-color); }
        .status-indicator.purple { background-color: #800080; }


        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            background: none;
            border: none;
            cursor: pointer;
            color: #888;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            font-size: 20px;
            color: var(--primary-color);
        }

        .modal-content pre {
            background-color: var(--light-gray);
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-content .modal-actions {
            margin-top: 25px;
            text-align: right;
        }

        #productCatalogModal .modal-content {
            max-width: 800px;
        }

        #productCatalogModal .modal-content .search-bar {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        #productCatalogModal .modal-content .search-bar input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        #productCatalogModal .modal-content .product-catalog-table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        #productCatalogModal .modal-content .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        #productCatalogModal .modal-content .data-table th,
        #productCatalogModal .modal-content .data-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            text-align: left;
            font-size: 13px;
        }

        #productCatalogModal .modal-content .data-table th {
            background-color: #f7f7f7;
            font-weight: 600;
            text-transform: uppercase;
        }

        #productCatalogModal .modal-content .data-table tbody tr:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }

        .needs-review {
            background-color: #fff3cd !important;
            border: 1px solid #ffc107 !important;
        }

        .summary-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }

        .summary-section h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .supplier-summary-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .supplier-status-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
        }

        .price-difference-positive {
            color: var(--red-alert);
            font-weight: bold;
        }

        .price-difference-negative {
            color: var(--green-success);
            font-weight: bold;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 20px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px dashed #e9ecef;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #555;
            flex-basis: 40%;
            text-align: left;
        }

        .detail-value {
            font-weight: 600;
            color: #333;
            flex-basis: 60%;
            text-align: right;
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }

        .tracking-steps {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 0;
            position: relative;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 120px;
        }

        .tracking-steps::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .tracking-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 100px;
            position: relative;
            z-index: 2;
            padding: 0 10px;
        }

        .tracking-step .circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .tracking-step span {
            font-size: 12px;
            text-align: center;
            color: #666;
            word-wrap: break-word;
            white-space: normal;
        }

        .tracking-step.completed .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .tracking-step.active .circle {
            background-color: var(--primary-color);
            color: #fff;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .tracking-step.pending .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .tracking-step.rejected .circle,
        .tracking-step.cancelled .circle {
            background-color: var(--red-alert);
            color: #fff;
        }
        .tracking-step.approved .circle,
        .tracking-step.production .circle,
        .tracking-step.ready-cargo .circle,
        .tracking-step.atd .circle,
        .tracking-step.pending-doc .circle,
        .tracking-step.doc-ok .circle,
        .tracking-step.ata .circle,
        .tracking-step.finished .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .tracking-step.negotiation .circle,
        .tracking-step.waiting-approval .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .tracking-step.separation .circle,
        .tracking-step.conference .circle,
        .tracking-step.in-transit .circle,
        .tracking-step.delivered .circle {
            background-color: var(--primary-color);
            color: #fff;
        }

        .tracking-step.completed span {
            color: #333;
            font-weight: 500;
        }
        .tracking-step.active span {
            color: var(--primary-color);
            font-weight: bold;
        }
        .tracking-step.rejected span,
        .tracking-step.cancelled span {
            color: var(--red-alert);
            font-weight: bold;
        }

        .colombia-col {
            background-color: var(--colombia-bg);
            border-left: 1px solid var(--colombia-border);
            border-right: 1px solid var(--colombia-border);
        }

        .hongkong-col {
            background-color: var(--hongkong-bg);
            border-left: 1px solid var(--hongkong-border);
            border-right: 1px solid var(--hongkong-border);
        }

        .cubage-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        .cubage-table th,
        .cubage-table td {
            border: 1px solid var(--border-color);
            padding: 3px 5px;
            text-align: left;
            font-size: 11px;
        }

        .cubage-table th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            text-transform: uppercase;
        }

        /* Specific styles for Renato Approval Screen table */
        #renatoApprovalScreen .data-table {
            table-layout: fixed; /* Ensures columns respect defined widths */
        }

        #renatoApprovalScreen .data-table th,
        #renatoApprovalScreen .data-table td {
            white-space: normal; /* Allow text to wrap */
            word-wrap: break-word; /* Ensure long words break */
            font-size: 12px; /* Slightly smaller font for more content */
            padding: 8px 5px; /* Reduced padding */
        }

        /* Adjusted column widths for new column order */
        #renatoApprovalScreen .data-table thead th:nth-child(1) { width: 8%; } /* C√≥d Produto */
        #renatoApprovalScreen .data-table thead th:nth-child(2) { width: 15%; } /* Descri√ß√£o */
        #renatoApprovalScreen .data-table thead th:nth-child(3) { width: 5%; } /* Qtd. */
        #renatoApprovalScreen .data-table thead th:nth-child(4) { width: 8%; } /* Valor Unit. Interno */
        #renatoApprovalScreen .data-table thead th:nth-child(5) { width: 8%; } /* Valor Unit. Fornecedor */
        #renatoApprovalScreen .data-table thead th:nth-child(6) { width: 8%; } /* Dif */
        #renatoApprovalScreen .data-table thead th:nth-child(7) { width: 8%; } /* Pre√ßo Unit. Venda */
        #renatoApprovalScreen .data-table thead th:nth-child(8) { width: 8%; } /* Pre√ßo Total Venda */
        #renatoApprovalScreen .data-table thead th:nth-child(9) { width: 8%; } /* Margem Estimada */
        #renatoApprovalScreen .data-table thead th:nth-child(10) { width: 8%; } /* Valor Total Interno */
        #renatoApprovalScreen .data-table thead th:nth-child(11) { width: 8%; } /* Valor Total Fornecedor */
        #renatoApprovalScreen .data-table thead th:nth-child(12) { width: 7%; } /* Status Aprova√ß√£o */
        #renatoApprovalScreen .data-table thead th:nth-child(13) { width: 5%; } /* A√ß√£o */


        /* Adjusted styles for smaller approval buttons with icons */
        .approval-buttons-group {
            display: flex;
            flex-direction: column; /* Stack buttons vertically */
            gap: 2px; /* Smaller gap between buttons */
            align-items: stretch; /* Make buttons fill available width */
        }

        .approval-buttons-group .btn {
            padding: 3px 6px; /* Even smaller padding for buttons */
            font-size: 14px; /* Larger font size for icons */
            line-height: 1; /* Ensure icon is centered vertically */
            white-space: nowrap;
            text-align: center;
            display: flex; /* Use flexbox for centering icon */
            justify-content: center;
            align-items: center;
            min-width: 28px; /* Minimum width for the button */
            min-height: 28px; /* Minimum height for the button */
            background-color: transparent; /* Remove background color */
            border: 1px solid transparent; /* Transparent border by default */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }

        .approval-buttons-group .btn:hover {
            border-color: var(--primary-color); /* Highlight border on hover */
            box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.3);
        }

        .approval-buttons-group .btn.selected {
            border: 1px solid var(--primary-color); /* Thinner border */
            box-shadow: 0 0 0 1px rgba(0, 123, 255, 0.3); /* Smaller shadow */
            background-color: rgba(0, 123, 255, 0.1); /* Light background when selected */
        }

        /* Styles for Flowchart Modal */
        #flowchartModal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1001; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        #flowchartModal.active {
            display: flex;
        }

        #flowchartModal .modal-content {
            margin: auto;
            display: block;
            width: 90%;
            height: 90%;
            max-width: 1200px; /* Adjust as needed */
            max-height: 800px; /* Adjust as needed */
            background-color: #fff; /* White background for the image */
            padding: 20px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #flowchartModal .modal-content img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Ensures the image fits within the modal without cropping */
        }

        #flowchartModal .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #333; /* Darker color for visibility on white background */
            font-size: 35px;
            font-weight: bold;
            transition: 0.3s;
            background: none;
            border: none;
            cursor: pointer;
            z-index: 1002; /* Ensure close button is above image */
        }

        #flowchartModal .modal-close-btn:hover,
        #flowchartModal .modal-close-btn:focus {
            color: #999;
            text-decoration: none;
            cursor: pointer;
        }

        /* Loader styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* New styles for enhanced detailed view */
        .po-overview {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding: 20px;
            background-color: var(--highlight-bg);
            border: 1px solid var(--highlight-border);
            border-radius: 8px;
            box-shadow: var(--shadow);
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .po-overview-left,
        .po-overview-right {
            flex: 1;
            min-width: 300px; /* Ensure columns don't get too narrow */
            padding-right: 20px;
        }

        .po-overview-right {
            padding-right: 0;
            padding-left: 20px;
            border-left: 1px solid rgba(0,0,0,0.1); /* Separator */
        }

        .po-overview h3 {
            font-size: 18px;
            color: var(--dark-blue);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .po-overview p {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .po-overview p strong {
            color: var(--text-color);
        }

        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-color);
        }

        .financial-metric {
            text-align: center;
            padding: 10px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .financial-metric .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .financial-metric .value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }
        .financial-metric .value.positive { color: var(--red-alert); }
        .financial-metric .value.negative { color: var(--green-success); }

        .logistics-commercial-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 25px;
            padding: 20px;
            background-color: #fcfcfc;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .logistics-commercial-details h4 {
            grid-column: 1 / -1; /* Span all columns */
            font-size: 16px;
            color: var(--dark-blue);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .detail-item {
            margin-bottom: 10px;
        }

        .detail-item .label {
            font-size: 13px;
            color: #555;
            font-weight: 500;
        }

        .detail-item .value {
            font-size: 14px;
            font-weight: bold;
            color: var(--text-color);
        }

        .tracking-timeline {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 20px 0;
            position: relative;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            white-space: nowrap;
            min-height: 120px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
        }

        .tracking-timeline::before {
            content: '';
            position: absolute;
            top: 40px;
            left: 20px;
            right: 20px;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .timeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            min-width: 100px;
            position: relative;
            z-index: 2;
            padding: 0 10px;
        }

        .timeline-step .circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
            flex-shrink: 0;
        }

        .timeline-step span {
            font-size: 12px;
            text-align: center;
            color: #666;
            word-wrap: break-word;
            white-space: normal;
        }

        .timeline-step.completed .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .timeline-step.active .circle {
            background-color: var(--primary-color);
            color: #fff;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .timeline-step.pending .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .timeline-step.rejected .circle,
        .timeline-step.cancelled .circle {
            background-color: var(--red-alert);
            color: #fff;
        }
        .timeline-step.approved .circle,
        .timeline-step.production .circle,
        .timeline-step.ready-cargo .circle,
        .timeline-step.atd .circle,
        .timeline-step.pending-doc .circle,
        .timeline-step.doc-ok .circle,
        .timeline-step.ata .circle,
        .timeline-step.finished .circle {
            background-color: var(--green-success);
            color: #fff;
        }
        .timeline-step.negotiation .circle,
        .timeline-step.waiting-approval .circle {
            background-color: var(--orange-warning);
            color: #fff;
        }
        .timeline-step.separation .circle,
        .timeline-step.conference .circle,
        .timeline-step.in-transit .circle,
        .timeline-step.delivered .circle {
            background-color: var(--primary-color);
            color: #fff;
        }

        .timeline-step.completed span {
            color: #333;
            font-weight: 500;
        }
        .timeline-step.active span {
            color: var(--primary-color);
            font-weight: bold;
        }
        .timeline-step.rejected span,
        .timeline-step.cancelled span {
            color: var(--red-alert);
            font-weight: bold;
        }

        /* Styles for Document Viewer Modal */
        #documentViewerModal .modal-content {
            max-width: 90%;
            height: 90%;
            display: flex;
            flex-direction: column;
        }

        #documentViewerModal .modal-content iframe {
            flex-grow: 1;
            margin-top: 15px;
        }

        #documentViewerModal .modal-content #documentViewerMessage {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            color: #666;
        }

        .document-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .document-card {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            width: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
        }

        .document-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .document-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .document-card h4 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--dark-blue);
        }

        .document-card .btn-view {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease-in-out;
        }

        .document-card .btn-view:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>

    <div id="renatoApprovalScreen" class="page active">
        <header class="header">
            <div class="header-left">
                <h1>Aprova√ß√£o de Pre√ßos - Gerencial</h1>
                <p>Analise e aprove os pedidos de compra.</p>
            </div>
            <div class="header-right">
                <span class="header-icon" onclick="showScreenInfo()"><i class="icon-question"></i></span>
                <span class="header-icon" onclick="openFlowchartModal()"><i class="icon-flow"></i></span> <!-- Bot√£o Fluxo -->
                <button class="btn-secondary" id="renatoLogoutButton">Sair (Logout)</button>
            </div>
        </header>
        <div class="container">
            <!-- Main Tabs for Renato Approval Screen -->
            <div class="tab-buttons" id="renatoApprovalMainTabs">
                <button class="tab-button active" onclick="switchRenatoApprovalMainTab('pendingApproval')">Aguardando Aprova√ß√£o</button>
                <button class="tab-button" onclick="switchRenatoApprovalMainTab('finalizedOrders')">Pedidos Finalizados</button>
            </div>

            <!-- Content for Main Tabs -->
            <div id="pendingApprovalTab" class="tab-content active">
                <h2 class="text-xl font-semibold mb-4">Pedidos Aguardando Sua Aprova√ß√£o</h2>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>ID SOLICITA√á√ÉO PRINCIPAL</th>
                                <th>N¬∫ PO</th>
                                <th>CLIENTE (NOME)</th>
                                <th>FORNECEDOR (NOME)</th>
                                <th>VALOR TOTAL</th>
                                <th>√öLTIMA ATUALIZA√á√ÉO</th>
                                <th>STATUS</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="pendingOrdersTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="finalizedOrdersTab" class="tab-content">
                <h2 class="text-xl font-semibold mb-4">Pedidos Finalizados</h2>
                <div class="table-container">
                    <table class="w-full">
                        <thead>
                            <tr>
                                <th>ID SOLICITA√á√ÉO PRINCIPAL</th>
                                <th>N¬∫ PO</th>
                                <th>CLIENTE (NOME)</th>
                                <th>FORNECEDOR (NOME)</th>
                                <th>VALOR TOTAL</th>
                                <th>√öLTIMA ATUALIZA√á√ÉO</th>
                                <th>STATUS</th>
                                <th>A√á√ÉO</th>
                            </tr>
                        </thead>
                        <tbody id="finalizedOrdersTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Detailed Approval View (now contains sub-tabs) -->
            <div id="detailedApprovalView" class="hidden">
                <h2 class="text-xl font-semibold mb-4">An√°lise Detalhada da PO: <span id="currentDetailedParentOrderIdDisplay"></span></h2>

                <!-- Sub-tabs for Detailed PO View -->
                <div class="tab-buttons" id="detailedPoSubTabs">
                    <button class="tab-button active" onclick="switchDetailedPOTab('general')">Geral</button>
                    <button class="tab-button" onclick="switchDetailedPOTab('documents')">Documentos</button>
                </div>

                <!-- Content for Sub-tabs -->
                <div id="generalTabContent" class="tab-content active">
                    <div id="poAnalysisContent">
                        <!-- Conte√∫do anal√≠tico da PO ser√° renderizado aqui -->
                    </div>
                </div>

                <div id="documentsTabContent" class="tab-content">
                    <p class="text-gray-600 mb-6">Selecione o documento que deseja consultar para esta PO.</p>
                    <div id="documentsContent" class="document-list">
                        <!-- Document cards will be rendered here -->
                    </div>
                </div>

                <div class="form-actions mt-6">
                    <button class="btn-secondary" onclick="backToMainList()">Voltar para Lista</button>
                    <button class="btn-primary" id="saveApprovalBtn" onclick="saveApprovalDecisions()" disabled>Salvar Decis√µes</button>
                    <button class="btn-primary" id="finalizeApprovalBtn" onclick="displayRenatoFinalSummary()" disabled>Finalizar Aprova√ß√£o</button>
                </div>
            </div>

            <div id="analysisLoadingScreen" class="modal-overlay">
                <div class="modal-content text-center">
                    <h3>Calculando An√°lise...</h3>
                    <p>Por favor, aguarde enquanto preparamos os dados para aprova√ß√£o.</p>
                    <div class="loader mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="hongKongFinalScreen" class="page">
        <header class="header">
            <div class="header-left">
                <h1 id="hongKongFinalTitle"></h1>
                <p id="hongKongFinalMessage"></p>
            </div>
            <div class="header-right">
                <span class="header-icon" onclick="showScreenInfo()"><i class="icon-question"></i></span>
                <span class="header-icon" onclick="openFlowchartModal()"><i class="icon-flow"></i></span> <!-- Bot√£o Fluxo -->
            </div>
        </header>
        <div class="container">
            <div class="form-section">
                <h2 class="text-xl font-semibold mb-4">Detalhes da Aprova√ß√£o</h2>
                <div id="finalDetailsHK" class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                </div>
            </div>
            <div class="form-actions">
                <button class="btn-primary" onclick="backToLogin()">Voltar para Login</button>
            </div>
        </div>
    </div>

    <div id="messageModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="messageModalCloseBtn">&times;</button>
            <h3 id="messageModalTitle"></h3>
            <div id="messageModalContent"></div>
            <div class="modal-actions">
                <button class="btn-primary" id="messageModalConfirmBtn">OK</button>
                <button class="btn-secondary" id="messageModalCancelBtn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Flowchart Modal Structure -->
    <div id="flowchartModal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close-btn" onclick="closeFlowchartModal()">&times;</span>
            <img id="flowchartImage" src="https://raw.githubusercontent.com/SamuelJuniorrr/importexport/refs/heads/main/fluxograma.png" alt="Fluxograma do Processo">
        </div>
    </div>

    <!-- Document Viewer Modal Structure -->
    <div id="documentViewerModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeDocumentViewerModal()">&times;</button>
            <h3 id="documentViewerTitle"></h3>
            <iframe id="documentViewerFrame" style="width: 100%; height: calc(100% - 60px); border: none;"></iframe>
            <div id="documentViewerMessage" style="display: none; padding: 20px; text-align: center;"></div>
        </div>
    </div>

    <script>
        let currentScreen = 'renatoApprovalScreen'; // Define a tela inicial como a de aprova√ß√£o do gestor
        let currentViewingPO = null; // PO atualmente selecionada para detalhes de aprova√ß√£o

        // Constantes para c√°lculo de cubagem de containers
        const MAX_CUBAGE_20HC = 37.4; // Capacidade m√°xima de um container de 20HC em m¬≥
        const MAX_CUBAGE_40HC = 76.0; // Capacidade m√°xima de um container de 40HC em m¬≥

        // Dados simulados das Ordens de Compra (POs)
        // Adicionadas informa√ß√µes de currentInternalSalePrice e statusHistory
        let generatedPurchaseOrders = [
            {
                parentOrderId: 'SOL-001', id: 'PED-001', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-20',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 10, currentInternalUnitPrice: 160.00, newSupplierUnitPrice: 155.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 220.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (10 * 155).toFixed(2), currentInternalPriceTotal: (10 * 160).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (10 * 0.005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-06-20',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'AG 03/25 TYBR', supplierEmail: 'fornecedorA@example.com', terms: '20% TT balance after BL - FOB Ningbo Port', freight: '1 X 40ft regular Container', etd: '2025-05-20', eta: '2025-05-04',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'BR 470 - INGO HERING, N¬∫ 4, BAIRRO S√ÉO DOMINGOS, 88370-888 - NAVEGANTES, SC, BRASIL', clientShipAddress: 'BR 470 - INGO HERING, N¬∫ 4, BAIRRO S√ÉO DOMINGOS, 88370-888 - NAVEGANTES, SC, BRASIL',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-15' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-18' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-20' }
                ]
            },
            {
                parentOrderId: 'SOL-014', id: 'PED-017', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-06-30',
                products: [
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 20, currentInternalUnitPrice: 48.00, newSupplierUnitPrice: 42.00, approvalStatus: 'Pendente', cubageUnit: 0.001, currentInternalSalePrice: 60.00, targetProfitMarginPercent: 30 }
                ],
                newSupplierPriceTotal: (20 * 42).toFixed(2), currentInternalPriceTotal: (20 * 48).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (20 * 0.001).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-06-30',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Siempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'AG 04/25 TYBR', supplierEmail: 'fornecedorC@example.com', terms: 'Net 60', freight: 'CIF Hong Kong', etd: '2025-06-20', eta: '2025-07-05',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-30' }
                ]
            },
            {
                parentOrderId: 'SOL-003', id: 'PED-005', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-24',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 2, currentInternalUnitPrice: 158.00, newSupplierUnitPrice: 152.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 210.00, targetProfitMarginPercent: 20 },
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 3, currentInternalUnitPrice: 48.00, newSupplierUnitPrice: 46.00, approvalStatus: 'Pendente', cubageUnit: 0.001, currentInternalSalePrice: 65.00, targetProfitMarginPercent: 28 }
                ],
                newSupplierPriceTotal: (2 * 152 + 3 * 46).toFixed(2), currentInternalPriceTotal: (2 * 158 + 3 * 48).toFixed(2), overallApprovalStatus: 'Negociado',
                totalCubage: (2 * 0.005 + 3 * 0.001).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-9876', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'EXW Hong Kong', etd: '2025-07-05', eta: '2025-07-20',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-22' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-24' },
                    { status: 'Negociado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-015', id: 'PED-018', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-29',
                products: [
                    { code: 'PROD004', name: 'Smartwatch Sport Y', quantity: 5, currentInternalUnitPrice: 85.00, newSupplierUnitPrice: 82.00, approvalStatus: 'Pendente', cubageUnit: 0.002, currentInternalSalePrice: 110.00, targetProfitMarginPercent: 22 }
                ],
                newSupplierPriceTotal: (5 * 82).toFixed(2), currentInternalPriceTotal: (5 * 85).toFixed(2), overallApprovalStatus: 'Negociado',
                totalCubage: (5 * 0.002).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-5432', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-10', eta: '2025-07-25',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-27' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' },
                    { status: 'Negociado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-008', id: 'PED-015', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-29',
                products: [
                    { code: 'PROD001', name: 'Smartphone Premium X1', quantity: 5, currentInternalUnitPrice: 158.00, newSupplierUnitPrice: 152.00, approvalStatus: 'Pendente', cubageUnit: 0.005, currentInternalSalePrice: 210.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (5 * 152).toFixed(2), currentInternalPriceTotal: (5 * 158).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (5 * 0.005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Siempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'PO-1122', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-15', eta: '2025-07-30',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Calle Falsa, 123', clientShipAddress: 'Av. Siempre Viva, 742',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-26' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' }
                ]
            },
            {
                parentOrderId: 'SOL-008', id: 'PED-016', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-29',
                products: [
                    { code: 'PROD002', name: 'Tablet Pro Z', quantity: 2, currentInternalUnitPrice: 260.00, newSupplierUnitPrice: 255.00, approvalStatus: 'Pendente', cubageUnit: 0.008, currentInternalSalePrice: 350.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (2 * 255).toFixed(2), currentInternalPriceTotal: (2 * 260).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (2 * 0.008).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-3344', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'EXW Hong Kong', etd: '2025-07-10', eta: '2025-07-25',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-26' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-29' }
                ]
            },
            {
                parentOrderId: 'SOL-016', id: 'PED-019', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-30',
                products: [
                    { code: 'PROD005', name: 'C√¢mera Digital Ultra HD', quantity: 1, currentInternalUnitPrice: 320.00, newSupplierUnitPrice: 310.00, approvalStatus: 'Pendente', cubageUnit: 0.01, currentInternalSalePrice: 400.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (1 * 310).toFixed(2), currentInternalPriceTotal: (1 * 320).toFixed(2), overallApprovalStatus: 'Aguardando Aprova√ß√£o',
                totalCubage: (1 * 0.01).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-02',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-5566', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-07-15', eta: '2025-07-30',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-27' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-29' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-30' }
                ]
            },
            {
                parentOrderId: 'SOL-020', id: 'PED-021', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-07-01',
                products: [
                    { code: 'PROD004', name: 'Smartwatch Sport Y', quantity: 3, currentInternalUnitPrice: 85.00, newSupplierUnitPrice: 88.00, approvalStatus: 'Rejeitar', cubageUnit: 0.002, currentInternalSalePrice: 110.00, targetProfitMarginPercent: 22 }
                ],
                newSupplierPriceTotal: (3 * 88).toFixed(2), currentInternalPriceTotal: (3 * 85).toFixed(2), overallApprovalStatus: 'Rejeitado',
                totalCubage: (3 * 0.002).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-03',
                clientName: 'Cliente Chile', billTo: 'Calle Falsa, 123', shipTo: 'Av. Siempre Viva, 742', clientEmail: 'cliente.chile@example.com',
                orderNumber: 'PO-7788', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'CIF Hong Kong', etd: '2025-07-05', eta: '2025-07-20',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Calle Falsa, 123', clientShipAddress: 'Av. Siempre Viva, 742',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-28' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-30' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-07-01' },
                    { status: 'Rejeitado', date: '2025-07-03' }
                ]
            },
            {
                parentOrderId: 'SOL-005', id: 'PED-010', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-06-26',
                products: [
                    { code: 'PROD005', name: 'C√¢mera Digital Ultra HD', quantity: 3, currentInternalUnitPrice: 335.00, newSupplierUnitPrice: 320.00, approvalStatus: 'Aprovado', cubageUnit: 0.01, currentInternalSalePrice: 450.00, targetProfitMarginPercent: 25 }
                ],
                newSupplierPriceTotal: (3 * 320).toFixed(2), currentInternalPriceTotal: (3 * 335).toFixed(2), overallApprovalStatus: 'Aprovado',
                totalCubage: (3 * 0.01).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-03',
                clientName: 'Cliente Paraguai', billTo: 'Rua Principal, 1', shipTo: 'Av. Secund√°ria, 2', clientEmail: 'cliente.paraguai@example.com',
                orderNumber: 'PO-9900', supplierEmail: 'fornecedorC@example.com', terms: 'Net 60', freight: 'EXW Hong Kong', etd: '2025-07-01', eta: '2025-07-15',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Principal, 1', clientShipAddress: 'Av. Secund√°ria, 2',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-23' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-26' },
                    { status: 'Aprovado', date: '2025-07-03' }
                ]
            },
            {
                parentOrderId: 'SOL-009', id: 'PED-002', supplier: 'Fornecedor B', supplierCode: '33', date: '2025-06-21',
                products: [
                    { code: 'PROD007', name: 'Cadeira Ergon√¥mica', quantity: 2, currentInternalUnitPrice: 630.00, newSupplierUnitPrice: 600.00, approvalStatus: 'Aprovado', cubageUnit: 0.15, currentInternalSalePrice: 800.00, targetProfitMarginPercent: 20 }
                ],
                newSupplierPriceTotal: (2 * 600).toFixed(2), currentInternalPriceTotal: (2 * 630).toFixed(2), overallApprovalStatus: 'Aprovado',
                totalCubage: (2 * 0.15).toFixed(2), originCountry: 'Col√¥mbia', lastUpdateDate: '2025-07-01',
                clientName: 'Cliente Colombia', billTo: 'Carrera 10, 10-10', shipTo: 'Avenida 20, 20-20', clientEmail: 'cliente.colombia@example.com',
                orderNumber: 'PO-1234', supplierEmail: 'fornecedorB@example.com', terms: 'Net 30', freight: 'FOB Colombia', etd: '2025-06-25', eta: '2025-07-01',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Carrera 10, 10-10', clientShipAddress: 'Avenida 20, 20-20',
                portDestination: 'Cartagena Port, Colombia',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-15' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-18' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-20' },
                    { status: 'Aprovado', date: '2025-07-01' }
                ]
            },
            {
                parentOrderId: 'SOL-017', id: 'PED-020', supplier: 'Fornecedor A', supplierCode: '22', date: '2025-06-25',
                products: [
                    { code: 'PROD006', name: 'Bateria Port√°til Mega', quantity: 15, currentInternalUnitPrice: 28.00, newSupplierUnitPrice: 22.00, approvalStatus: 'Aprovado', cubageUnit: 0.0005, currentInternalSalePrice: 40.00, targetProfitMarginPercent: 30 }
                ],
                newSupplierPriceTotal: (15 * 22).toFixed(2), currentInternalPriceTotal: (15 * 28).toFixed(2), overallApprovalStatus: 'Finalizado',
                totalCubage: (15 * 0.0005).toFixed(2), originCountry: 'Hong Kong', lastUpdateDate: '2025-07-05',
                clientName: 'Cliente Mexico', billTo: 'Rua Exemplo, 123', shipTo: 'Av. Teste, 456', clientEmail: 'cliente.mexico@example.com',
                orderNumber: 'PO-4321', supplierEmail: 'fornecedorA@example.com', terms: 'Net 30', freight: 'FOB Hong Kong', etd: '2025-06-28', eta: '2025-07-10',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Rua Exemplo, 123', clientShipAddress: 'Av. Teste, 456',
                portDestination: 'Navegantes Port, Brazil',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-20' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-22' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-06-25' },
                    { status: 'Aprovado', date: '2025-07-01' },
                    { status: 'Finalizado', date: '2025-07-05' }
                ]
            },
            {
                parentOrderId: 'SOL-018', id: 'SAP-001', supplier: 'Fornecedor C', supplierCode: '44', date: '2025-07-01',
                products: [
                    { code: 'PROD009', name: 'Monitor Ultrawide', quantity: 1, currentInternalUnitPrice: 350.00, newSupplierUnitPrice: 350.00, approvalStatus: 'Aprovado', cubageUnit: 0.05, currentInternalSalePrice: 500.00, targetProfitMarginPercent: 30 },
                    { code: 'PROD003', name: 'Fone Bluetooth Max', quantity: 3, currentInternalUnitPrice: 50.00, newSupplierUnitPrice: 50.00, approvalStatus: 'Aprovado', cubageUnit: 0.001, currentInternalSalePrice: 70.00, targetProfitMarginPercent: 28 }
                ],
                newSupplierPriceTotal: (1 * 350 + 3 * 50).toFixed(2), currentInternalPriceTotal: (1 * 350 + 3 * 50).toFixed(2), overallApprovalStatus: 'Em Separa√ß√£o',
                totalCubage: (1 * 0.05 + 3 * 0.001).toFixed(2), originCountry: 'Col√¥mbia', lastUpdateDate: '2025-07-05',
                clientName: 'Cliente Colombia', billTo: 'Carrera 10, 10-10', shipTo: 'Avenida 20, 20-20', clientEmail: 'cliente.colombia@example.com',
                orderNumber: 'SAP-9876', supplierEmail: 'fornecedorC@example.com', terms: 'Cash', freight: 'Terrestre', etd: '2025-07-02', eta: '2025-07-05',
                clientCnpj: '03.817.469/0003-78', clientAddress: 'Carrera 10, 10-10', clientShipAddress: 'Avenida 20, 20-20',
                portDestination: 'Cartagena Port, Colombia',
                statusHistory: [
                    { status: 'Solicitado', date: '2025-06-25' },
                    { status: 'Em Negocia√ß√£o', date: '2025-06-28' },
                    { status: 'Aguardando Aprova√ß√£o', date: '2025-07-01' },
                    { status: 'Aprovado', date: '2025-07-02' },
                    { status: 'Em Separa√ß√£o', date: '2025-07-05' }
                ]
            }
        ];

        // Mapa para gerenciar c√≥digos e nomes de fornecedores (simulado)
        const supplierCodeMap = {};
        const supplierNameMap = {};
        let nextSupplierCode = 22; // C√≥digo inicial para novos fornecedores

        /**
         * Retorna o c√≥digo do fornecedor ou gera um novo se n√£o existir.
         * @param {string} supplierName Nome do fornecedor.
         * @returns {string} C√≥digo do fornecedor.
         */
        function getOrGenerateSupplierCode(supplierName) {
            if (!supplierCodeMap[supplierName]) {
                let maxCode = 0;
                for (const key in supplierCodeMap) {
                    maxCode = Math.max(maxCode, parseInt(supplierCodeMap[key]));
                }
                nextSupplierCode = maxCode + 11; // Incrementa o c√≥digo para o pr√≥ximo fornecedor
                supplierCodeMap[supplierName] = String(nextSupplierCode);
                supplierNameMap[String(nextSupplierCode)] = supplierName;
            }
            return supplierCodeMap[supplierName];
        }

        /**
         * Exibe uma tela espec√≠fica e oculta as outras.
         * @param {string} screenId O ID da tela a ser exibida.
         */
        function showScreen(screenId) {
            document.querySelectorAll('.page').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            currentScreen = screenId;
        }

        /**
         * Exibe um modal de mensagem gen√©rico.
         * @param {string} title T√≠tulo do modal.
         * @param {string} content Conte√∫do HTML do modal.
         * @param {string} type Tipo de mensagem ('info', 'success', 'error').
         * @param {function} onConfirm Callback para o bot√£o OK/Confirmar.
         * @param {function} onCancel Callback para o bot√£o Cancelar.
         */
        function showMessage(title, content, type = 'info', onConfirm = null, onCancel = null) {
            const modal = document.getElementById('messageModal');
            document.getElementById('messageModalTitle').innerText = title;
            document.getElementById('messageModalContent').innerHTML = content;
            const confirmBtn = document.getElementById('messageModalConfirmBtn');
            const cancelBtn = document.getElementById('messageModalCancelBtn');
            const closeBtn = document.getElementById('messageModalCloseBtn');

            // Define os callbacks para os bot√µes do modal
            confirmBtn.onclick = () => { if (onConfirm) onConfirm(); modal.classList.remove('active'); };
            cancelBtn.onclick = () => { if (onCancel) onCancel(); modal.classList.remove('active'); };
            closeBtn.onclick = () => modal.classList.remove('active');

            // Oculta/exibe bot√µes com base na presen√ßa de callbacks
            confirmBtn.classList.add('hidden');
            cancelBtn.classList.add('hidden');
            closeBtn.classList.remove('hidden');

            if (onConfirm || onCancel) {
                closeBtn.classList.add('hidden');
                confirmBtn.classList.remove('hidden');
                if (onCancel) {
                    cancelBtn.classList.remove('hidden');
                }
            }
            modal.classList.add('active'); // Exibe o modal
        }

        /**
         * Exibe informa√ß√µes contextuais sobre a tela atual.
         */
        function showScreenInfo() {
            let info = '';
            switch (currentScreen) {
                case 'renatoApprovalScreen':
                    info = `
                        <h2 style="font-size:1.3rem; font-weight:bold; margin-bottom:10px;">üëî Aprova√ß√£o de Pre√ßos - Gerencial</h2>
                        <p>Esta tela √© o seu painel de controle para gerenciar e aprovar as Ordens de Compra (POs).</p>
                        <hr style="margin:16px 0;">
                        <h3 style="font-size:1.1rem; font-weight:bold; margin-bottom:8px;">Funcionalidades Principais:</h3>
                        <ul style="margin-bottom:10px; list-style-type: disc; margin-left: 20px;">
                            <li><b>An√°lise de POs Pendentes:</b> Visualize e priorize os pedidos que aguardam sua decis√£o.</li>
                            <li><b>Comparativo de Pre√ßos:</b> Compare de forma clara os valores internos dos produtos com os pre√ßos negociados pelos fornecedores, identificando rapidamente oportunidades de economia ou desvios.</li>
                            <li><b>Decis√£o por Produto:</b> Para cada item na PO, voc√™ pode:
                                <ul>
                                    <li>‚úÖ <b>Aprovar:</b> Aceita o pre√ßo negociado e permite que o processo avance.</li>
                                    <li>üîÑ <b>Negociar:</b> Indica que o pre√ßo precisa de uma nova rodada de negocia√ß√£o pela equipe de compras.</li>
                                    <li>‚ùå <b>Rejeitar:</b> Recusa o produto ou pre√ßo, encerrando o processo para aquele item.</li>
                                </ul>
                            </li>
                            <li><b>Vis√£o Gerencial:</b> Tenha acesso a m√©tricas importantes como diferen√ßa de custo, lucro bruto estimado e margem de lucro por produto, auxiliando na tomada de decis√µes estrat√©gicas.</li>
                            <li><b>Hist√≥rico de Status:</b> Acompanhe a linha do tempo de cada PO, desde a solicita√ß√£o at√© o status atual.</li>
                            <li><b>Documentos:</b> Acesse documentos relacionados √† PO, como solicita√ß√£o do cliente, PO de compras e PI do fornecedor.</li>
                        </ul>
                        <hr style="margin:16px 0;">
                        <p style="font-size:0.95rem;"><b>Dica:</b> Utilize os √≠cones de a√ß√£o na tabela para definir o status de cada produto. Certifique-se de que todos os produtos tenham um status definido antes de "Finalizar Aprova√ß√£o".</p>
                    `;
                    break;
                case 'hongKongFinalScreen':
                    info = `
                        <h2 style="font-size:1.3rem; font-weight:bold; margin-bottom:10px;">‚úÖ Aprova√ß√£o Finalizada</h2>
                        <p>Esta tela exibe o resultado final da sua aprova√ß√£o.</p>
                        <hr style="margin:16px 0;">
                        <ul style="margin-bottom:10px;">
                        <li>Confira o resumo dos produtos aprovados, rejeitados ou para renegocia√ß√£o.</li>
                        <li>O sistema atualizar√° o status da PO e notificar√° as equipes relevantes.</li>
                        </ul>
                        <hr style="margin:16px 0;">
                        <p style="font-size:0.95rem;"><b>Dica:</b> Voc√™ pode voltar para a lista de pedidos para continuar revisando outras POs.</p>
                    `;
                    break;
                default:
                    info = '<p>Esta tela faz parte do fluxo do portal. Para mais informa√ß√µes, consulte o manual ou o suporte.</p>';
            }
            showMessage('Informa√ß√µes da Tela', info, 'info');
        }

        /**
         * Simula o logout, retornando para a p√°gina de login.
         */
        function logout() {
            currentViewingPO = null;
            // Em um ambiente real, aqui voc√™ faria a limpeza de sess√£o, etc.
            // Para este prot√≥tipo, vamos apenas simular um retorno √† tela de login.
            window.location.href = 'index.html'; // Redireciona para a p√°gina de login
        }

        /**
         * Retorna a classe CSS para o indicador de status com base no status fornecido.
         * @param {string} status O status da PO ou produto.
         * @returns {string} A classe CSS correspondente.
         */
        function getStatusClass(status) {
            switch (status) {
                case 'Aprovado':
                case 'Finalizado':
                case 'Em Produ√ß√£o':
                case 'Carga Pronta':
                case 'Sa√≠da do Porto de Embarque (ATD)':
                case 'Documenta√ß√£o OK':
                case 'Chegada no Porto de Destino (ATA)':
                case 'Entregue':
                case 'Em Separa√ß√£o':
                case 'Em Confer√™ncia':
                case 'Em Rota de Entrega':
                    return 'green';
                case 'Pendente':
                case 'Aguardando Aprova√ß√£o':
                case 'Documenta√ß√£o Pendente':
                    return 'yellow';
                case 'Rejeitado':
                case 'Cancelado':
                    return 'red';
                case 'Negociado':
                    return 'purple';
                case 'Solicitado': // New status for tracking
                case 'Em Negocia√ß√£o':
                    return 'gray';
                default:
                    return 'yellow';
            }
        }

        /**
         * Renderiza a tabela de POs para a tela de aprova√ß√£o do gestor.
         * @param {string} tbodyId O ID do tbody da tabela a ser preenchida.
         * @param {Array<Object>} filteredPOs A lista de POs a serem exibidas.
         * @param {string} actionButtonText O texto do bot√£o de a√ß√£o.
         * @param {string} actionButtonFunction O nome da fun√ß√£o a ser chamada no clique do bot√£o.
         */
        function renderPOTable(tbodyId, filteredPOs, actionButtonText, actionButtonFunction) {
            const tbody = document.getElementById(tbodyId);
            if (!tbody) {
                console.error(`Error: tbody with ID '${tbodyId}' not found.`);
                return;
            }
            tbody.innerHTML = '';

            if (filteredPOs.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8" class="text-center py-4 text-gray-500">Nenhum pedido encontrado.</td></tr>`;
                return;
            }

            filteredPOs.forEach(po => {
                const row = document.createElement('tr');
                // Simula o nome do cliente, pois n√£o temos o objeto 'orders' globalmente aqui
                const clientName = po.clientName || 'Cliente Desconhecido';
                const supplierName = po.supplier || 'N/A';
                const lastUpdateDate = po.lastUpdateDate || po.date;
                
                let statusIndicatorClass = getStatusClass(po.overallApprovalStatus);

                let actionButtonHtml = '';
                if (actionButtonFunction) {
                    actionButtonHtml = `<button onclick="${actionButtonFunction}('${po.id}')" class="btn btn-primary btn-sm">${actionButtonText}</button>`;
                }

                row.innerHTML = `
                    <td>${po.parentOrderId || 'N/A'}</td>
                    <td>${po.id}</td>
                    <td>${clientName}</td>
                    <td>${supplierName}</td>
                    <td>R$ ${parseFloat(po.newSupplierPriceTotal).toFixed(2).replace('.', ',')}</td>
                    <td>${lastUpdateDate}</td>
                    <td><span class="status-indicator ${statusIndicatorClass}"></span>${po.overallApprovalStatus}</td>
                    <td>${actionButtonHtml}</td>
                `;
                tbody.appendChild(row);
            });
        }

        /**
         * Alterna entre as abas principais da tela de aprova√ß√£o do gestor.
         * @param {string} tabType O tipo da aba a ser ativada ('pendingApproval', 'finalizedOrders').
         */
        function switchRenatoApprovalMainTab(tabType) {
            const mainTabs = ['pendingApprovalTab', 'finalizedOrdersTab'];
            mainTabs.forEach(id => {
                const tabElement = document.getElementById(id);
                if (tabElement) {
                    tabElement.classList.remove('active');
                    tabElement.classList.add('hidden');
                }
            });

            const mainTabButtonsContainer = document.getElementById('renatoApprovalMainTabs');
            Array.from(mainTabButtonsContainer.children).forEach(button => {
                button.classList.remove('active');
            });

            // Hide detailed view if visible
            document.getElementById('detailedApprovalView').classList.add('hidden');
            document.getElementById('detailedApprovalView').classList.remove('active'); // Ensure it's not active

            if (tabType === 'pendingApproval') {
                document.getElementById('pendingApprovalTab').classList.add('active');
                document.getElementById('pendingApprovalTab').classList.remove('hidden');
                mainTabButtonsContainer.children[0].classList.add('active');
                renderPendingRenatoApprovalList();
            } else if (tabType === 'finalizedOrders') {
                document.getElementById('finalizedOrdersTab').classList.add('active');
                document.getElementById('finalizedOrdersTab').classList.remove('hidden');
                mainTabButtonsContainer.children[1].classList.add('active');
                renderFinalizedRenatoApprovalList();
            }
        }

        /**
         * Alterna entre as sub-abas da vis√£o detalhada da PO.
         * @param {string} tabType O tipo da sub-aba a ser ativada ('general', 'documents').
         */
        function switchDetailedPOTab(tabType) {
            const subTabs = ['generalTabContent', 'documentsTabContent'];
            subTabs.forEach(id => {
                const tabElement = document.getElementById(id);
                if (tabElement) {
                    tabElement.classList.remove('active');
                    tabElement.classList.add('hidden');
                }
            });

            const subTabButtonsContainer = document.getElementById('detailedPoSubTabs');
            Array.from(subTabButtonsContainer.children).forEach(button => {
                button.classList.remove('active');
            });

            if (tabType === 'general') {
                document.getElementById('generalTabContent').classList.add('active');
                document.getElementById('generalTabContent').classList.remove('hidden');
                subTabButtonsContainer.children[0].classList.add('active');
                renderPOAnalysisContent(); // Re-render general content
            } else if (tabType === 'documents') {
                document.getElementById('documentsTabContent').classList.add('active');
                document.getElementById('documentsTabContent').classList.remove('hidden');
                subTabButtonsContainer.children[1].classList.add('active');
                renderDocumentsContent(); // Render documents content
            }
        }

        /**
         * Renderiza a lista de POs aguardando aprova√ß√£o.
         */
        function renderPendingRenatoApprovalList() {
            const pendingForRenato = generatedPurchaseOrders.filter(po =>
                po.overallApprovalStatus === 'Aguardando Aprova√ß√£o'
            ).sort((a, b) => {
                // Ordena por data (mais antiga primeiro) e depois por ID
                if (a.date > b.date) return 1;
                if (a.date < b.date) return -1;
                return a.id.localeCompare(b.id);
            });
            renderPOTable('pendingOrdersTableBody', pendingForRenato, 'Visualizar Detalhes', 'viewDetailedApproval');
        }

        /**
         * Renderiza a lista de POs finalizadas (Aprovadas, Rejeitadas ou Finalizadas).
         */
        function renderFinalizedRenatoApprovalList() {
            const finalizedForRenato = generatedPurchaseOrders.filter(po =>
                po.overallApprovalStatus === 'Aprovado' ||
                po.overallApprovalStatus === 'Rejeitado' ||
                po.overallApprovalStatus === 'Finalizado' ||
                po.overallApprovalStatus === 'Negociado' // Inclui negociados que j√° foram revisados
            ).sort((a, b) => {
                if (a.date > b.date) return 1;
                if (a.date < b.date) return -1;
                return a.id.localeCompare(b.id);
            });
            renderPOTable('finalizedOrdersTableBody', finalizedForRenato, 'Visualizar Detalhes', 'viewDetailedApproval');
        }

        /**
         * Exibe a vis√£o detalhada de aprova√ß√£o para uma PO espec√≠fica.
         * @param {string} poId O ID da PO a ser detalhada.
         */
        function viewDetailedApproval(poId) {
            document.getElementById('analysisLoadingScreen').classList.add('active');

            setTimeout(() => {
                document.getElementById('analysisLoadingScreen').classList.remove('active');

                currentViewingPO = generatedPurchaseOrders.find(po => po.id === poId);
                if (!currentViewingPO) {
                    showMessage('Erro', 'Detalhes do pedido de compra n√£o encontrados.', 'error');
                    return;
                }

                // Hide main tabs and show detailed view
                document.getElementById('renatoApprovalMainTabs').classList.add('hidden');
                document.getElementById('pendingApprovalTab').classList.add('hidden');
                document.getElementById('finalizedOrdersTab').classList.add('hidden');

                document.getElementById('detailedApprovalView').classList.remove('hidden');
                document.getElementById('detailedApprovalView').classList.add('active');

                document.getElementById('currentDetailedParentOrderIdDisplay').innerText = currentViewingPO.parentOrderId || currentViewingPO.id;

                // Activate 'Geral' tab by default when entering detailed view
                switchDetailedPOTab('general');
                checkApprovalButtonsState();
            }, 2000); // Simula um tempo de carregamento
        }

        /**
         * Retorna para a lista principal de pedidos (Aguardando Aprova√ß√£o/Finalizados).
         */
        function backToMainList() {
            document.getElementById('detailedApprovalView').classList.add('hidden');
            document.getElementById('detailedApprovalView').classList.remove('active');

            document.getElementById('renatoApprovalMainTabs').classList.remove('hidden');
            switchRenatoApprovalMainTab('pendingApproval'); // Volta para a aba de pendentes por padr√£o
        }

        /**
         * Renderiza o conte√∫do anal√≠tico da PO para a tela de aprova√ß√£o gerencial.
         */
        function renderPOAnalysisContent() {
            const analysisContentDiv = document.getElementById('poAnalysisContent');
            analysisContentDiv.innerHTML = ''; // Limpa o conte√∫do anterior

            const po = currentViewingPO;

            // --- C√°lculos Financeiros da PO (geral) ---
            const totalExternalCostPO = parseFloat(po.newSupplierPriceTotal);
            const totalInternalCostPO = parseFloat(po.currentInternalPriceTotal);
            const costDifferencePO = totalExternalCostPO - totalInternalCostPO;
            const costDifferencePercentPO = totalInternalCostPO === 0 ? 0 : (costDifferencePO / totalInternalCostPO) * 100;

            let totalInternalSaleValuePO = 0;
            po.products.forEach(p => {
                totalInternalSaleValuePO += (parseFloat(p.currentInternalSalePrice) || 0) * p.quantity;
            });

            const grossProfitPO = totalInternalSaleValuePO - totalExternalCostPO;
            const grossMarginPO = totalInternalSaleValuePO > 0 ? (grossProfitPO / totalInternalSaleValuePO) * 100 : 0;

            // --- C√°lculos de Cubagem ---
            const totalCubage = parseFloat(po.totalCubage || 0);
            const MAX_CUBAGE_20HC = 37.4;
            const MAX_CUBAGE_40HC = 76.0;
            const percentageOccupation20HC = (totalCubage / MAX_CUBAGE_20HC) * 100;
            const percentageOccupation40HC = (totalCubage / MAX_CUBAGE_40HC) * 100;
            let containerSuggestion = 'LCL';
            if (totalCubage >= MAX_CUBAGE_40HC * 0.8) { // If 80% of 40HC is filled
                containerSuggestion = 'CTN 40HC (Recomendado)';
            } else if (totalCubage >= MAX_CUBAGE_20HC * 0.8) { // If 80% of 20HC is filled
                containerSuggestion = 'CTN 20 (Recomendado)';
            } else if (totalCubage > 0) {
                containerSuggestion = 'LCL (Carga Consolidada)';
            } else {
                containerSuggestion = 'N/A';
            }

            // --- HTML Structure ---
            let htmlContent = `
                <div class="po-overview">
                    <div class="po-overview-left">
                        <h3>Informa√ß√µes da PO</h3>
                        <p><strong>PO N¬∫:</strong> ${po.id}</p>
                        <p><strong>ID Solicita√ß√£o Principal:</strong> ${po.parentOrderId || 'N/A'}</p>
                        <p><strong>Data Gera√ß√£o:</strong> ${po.date}</p>
                        <p><strong>√öltima Atualiza√ß√£o:</strong> ${po.lastUpdateDate}</p>
                        <p><strong>Status Geral:</strong> <span class="status-indicator ${getStatusClass(po.overallApprovalStatus)}"></span>${po.overallApprovalStatus}</p>
                    </div>
                    <div class="po-overview-right">
                        <h3>Partes Envolvidas</h3>
                        <p><strong>Cliente:</strong> ${po.clientName || 'N/A'}</p>
                        <p><strong>Fornecedor:</strong> ${po.supplierCode || 'N/A'} - ${po.supplier || 'N/A'}</p>
                        <p><strong>Email Fornecedor:</strong> ${po.supplierEmail || 'N/A'}</p>
                        <p><strong>Endere√ßo Faturamento:</strong> ${po.billTo || 'N/A'}</p>
                        <p><strong>Endere√ßo Entrega:</strong> ${po.shipTo || 'N/A'}</p>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">An√°lise Financeira da PO</h3>
                <div class="financial-summary">
                    <div class="financial-metric">
                        <div class="label">Custo Total Interno</div>
                        <div class="value">R$ ${totalInternalCostPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Custo Total Fornecedor</div>
                        <div class="value">R$ ${totalExternalCostPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Diferen√ßa de Custo</div>
                        <div class="value ${costDifferencePO > 0 ? 'positive' : (costDifferencePO < 0 ? 'negative' : '')}">
                            R$ ${costDifferencePO.toFixed(2).replace('.', ',')} (${costDifferencePercentPO.toFixed(2)}%)
                        </div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Valor Total de Venda (Est.)</div>
                        <div class="value">R$ ${totalInternalSaleValuePO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Lucro Bruto Estimado</div>
                        <div class="value ${grossProfitPO < 0 ? 'positive' : 'negative'}">R$ ${grossProfitPO.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="financial-metric">
                        <div class="label">Margem Bruta Estimada</div>
                        <div class="value ${grossMarginPO < (po.products[0]?.targetProfitMarginPercent || 0) ? 'positive' : 'negative'}">
                            ${grossMarginPO.toFixed(2).replace('.', ',')}%
                        </div>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">Detalhes Log√≠sticos e Comerciais</h3>
                <div class="logistics-commercial-details">
                    <div class="detail-item">
                        <div class="label">Pa√≠s de Origem:</div>
                        <div class="value">${po.originCountry || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Porto de Destino:</div>
                        <div class="value">${po.portDestination || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Termos de Frete:</div>
                        <div class="value">${po.terms || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Tipo de Frete:</div>
                        <div class="value">${po.freight || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">ETD (Sa√≠da Estimada):</div>
                        <div class="value">${po.etd || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">ETA (Chegada Estimada):</div>
                        <div class="value">${po.eta || 'N/A'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Cubagem Total:</div>
                        <div class="value">${totalCubage.toFixed(2).replace('.', ',')} m¬≥</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Sugest√£o de Cont√™iner:</div>
                        <div class="value">${containerSuggestion}</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Ocupa√ß√£o CTN 20:</div>
                        <div class="value">${percentageOccupation20HC.toFixed(2).replace('.', ',')}%</div>
                    </div>
                    <div class="detail-item">
                        <div class="label">Ocupa√ß√£o CTN 40HC:</div>
                        <div class="value">${percentageOccupation40HC.toFixed(2).replace('.', ',')}%</div>
                    </div>
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">Hist√≥rico de Status da PO</h3>
                <div class="tracking-timeline">
                    ${po.statusHistory.map((history, index) => `
                        <div class="timeline-step ${getStatusClass(history.status)}">
                            <div class="circle">${index + 1}</div>
                            <span>${history.status}<br>${history.date}</span>
                        </div>
                    `).join('')}
                </div>

                <h3 class="font-semibold text-lg mb-3 mt-4" style="color: var(--dark-blue);">An√°lise Detalhada dos Produtos</h3>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>C√≥d Produto</th>
                                <th>Descri√ß√£o</th>
                                <th>Qtd.</th>
                                <th>Valor Unit. Interno</th>
                                <th>Valor Unit. Fornecedor</th>
                                <th>Dif</th>
                                <th>Pre√ßo Unit. Venda</th>
                                <th>Pre√ßo Total Venda</th>
                                <th>Margem Estimada</th>
                                <th>Valor Total Interno</th>
                                <th>Valor Total Fornecedor</th>
                                <th>Status Aprova√ß√£o</th>
                                <th>A√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${po.products.map((p, pIndex) => {
                                const diff = parseFloat(p.newSupplierUnitPrice) - parseFloat(p.currentInternalUnitPrice);
                                const percent = parseFloat(p.currentInternalUnitPrice) === 0
                                    ? 0
                                    : (diff / parseFloat(p.currentInternalUnitPrice)) * 100;
                                const diffClass = diff > 0 ? 'price-difference-positive' : (diff < 0 ? 'price-difference-negative' : '');
                                const diffText = diff > 0
                                    ? `+R$ ${diff.toFixed(2).replace('.', ',')} (+${percent.toFixed(2)}%)`
                                    : diff < 0
                                        ? `-R$ ${Math.abs(diff).toFixed(2).replace('.', ',')} (${percent.toFixed(2)}%)`
                                        : 'R$ 0,00 (0,00%)';
                                const totalInterno = parseFloat(p.currentInternalUnitPrice) * p.quantity;
                                const totalFornecedor = parseFloat(p.newSupplierUnitPrice) * p.quantity;
                                const precoUnitVenda = parseFloat(p.currentInternalSalePrice || 0);
                                const precoTotalVenda = precoUnitVenda * p.quantity;

                                // Calculate estimated margin for the product
                                const productGrossProfit = (precoUnitVenda - parseFloat(p.newSupplierUnitPrice)) * p.quantity;
                                const productEstimatedMargin = precoTotalVenda > 0 ? (productGrossProfit / precoTotalVenda) * 100 : 0;
                                const marginClass = productEstimatedMargin < (p.targetProfitMarginPercent || 0) ? 'price-difference-positive' : 'price-difference-negative'; // Highlight if below target

                                return `
                                    <tr>
                                        <td>${p.code}</td>
                                        <td>${p.name}</td>
                                        <td>${p.quantity}</td>
                                        <td>R$ ${parseFloat(p.currentInternalUnitPrice).toFixed(2).replace('.', ',')}</td>
                                        <td>R$ ${parseFloat(p.newSupplierUnitPrice).toFixed(2).replace('.', ',')}</td>
                                        <td><span class="${diffClass}">${diffText}</span></td>
                                        <td>R$ ${precoUnitVenda.toFixed(2).replace('.', ',')}</td>
                                        <td>R$ ${precoTotalVenda.toFixed(2).replace('.', ',')}</td>
                                        <td><span class="${marginClass}">${productEstimatedMargin.toFixed(2).replace('.', ',')}%</span></td>
                                        <td>R$ ${totalInterno.toFixed(2).replace('.', ',')}</td>
                                        <td>R$ ${totalFornecedor.toFixed(2).replace('.', ',')}</td>
                                        <td class="product-approval-status ${p.approvalStatus}">
                                            <span class="status-indicator ${getStatusClass(p.approvalStatus)}"></span>
                                            ${p.approvalStatus}
                                        </td>
                                        <td>
                                            <div class="approval-buttons-group">
                                                <button class="btn btn-sm btn-approve ${p.approvalStatus === 'Aprovado' ? 'selected' : ''}"
                                                        onclick="setProductApprovalStatus('${po.id}', '${p.code}', 'Aprovado')" title="Aprovar">‚úÖ</button>
                                                <button class="btn btn-sm btn-negotiate ${p.approvalStatus === 'Negociar' ? 'selected' : ''}"
                                                        onclick="setProductApprovalStatus('${po.id}', '${p.code}', 'Negociar')" title="Negociar">üîÑ</button>
                                                <button class="btn btn-sm btn-reject ${p.approvalStatus === 'Rejeitar' ? 'selected' : ''}"
                                                        onclick="setProductApprovalStatus('${po.id}', '${p.code}', 'Rejeitar')" title="Rejeitar">‚ùå</button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            analysisContentDiv.innerHTML = htmlContent;
        }

        /**
         * Define o status de aprova√ß√£o de um produto espec√≠fico dentro de uma PO.
         * @param {string} poId O ID da PO.
         * @param {string} productCode O c√≥digo do produto.
         * @param {string} status O novo status de aprova√ß√£o ('Aprovado', 'Negociar', 'Rejeitar').
         */
        function setProductApprovalStatus(poId, productCode, status) {
            const po = generatedPurchaseOrders.find(p => p.id === poId);
            if (po) {
                const product = po.products.find(prod => prod.code === productCode);
                if (product) {
                    product.approvalStatus = status;
                    renderPOAnalysisContent(); // Atualiza a exibi√ß√£o para refletir a mudan√ßa
                    checkApprovalButtonsState(); // Verifica se os bot√µes de a√ß√£o final devem ser habilitados
                }
            }
        }

        /**
         * Verifica o estado dos bot√µes "Salvar Decis√µes" e "Finalizar Aprova√ß√£o".
         * Eles s√£o habilitados apenas se todos os produtos da PO atual tiverem um status de aprova√ß√£o definido (n√£o 'Pendente').
         */
        function checkApprovalButtonsState() {
            const saveApprovalBtn = document.getElementById('saveApprovalBtn');
            const finalizeApprovalBtn = document.getElementById('finalizeApprovalBtn');

            const allProductsReviewed = currentViewingPO.products.every(p => p.approvalStatus !== 'Pendente');

            if (allProductsReviewed) {
                saveApprovalBtn.disabled = false;
                finalizeApprovalBtn.disabled = false;
            } else {
                saveApprovalBtn.disabled = true;
                finalizeApprovalBtn.disabled = true;
            }
        }

        /**
         * Salva as decis√µes de aprova√ß√£o (simulado).
         */
        function saveApprovalDecisions() {
            showMessage('Sucesso', 'Decis√µes de aprova√ß√£o salvas temporariamente. Finalize para aplicar as altera√ß√µes.', 'success');
        }

        /**
         * Exibe o resumo final da aprova√ß√£o e atualiza o status da PO.
         */
        function displayRenatoFinalSummary() {
            if (!currentViewingPO) {
                showMessage('Erro', 'Nenhum pedido selecionado para finalizar aprova√ß√£o.', 'error');
                return;
            }

            const allProductsReviewed = currentViewingPO.products.every(p => p.approvalStatus !== 'Pendente');
            if (!allProductsReviewed) {
                showMessage('Aten√ß√£o', 'Por favor, defina o status (Aprovar, Negociar ou Rejeitar) para TODOS os produtos antes de finalizar.', 'warning');
                return;
            }

            let approvedCount = 0;
            let negotiateCount = 0;
            let rejectedCount = 0;
            let totalProducts = currentViewingPO.products.length;

            currentViewingPO.products.forEach(p => {
                if (p.approvalStatus === 'Aprovado') approvedCount++;
                else if (p.approvalStatus === 'Negociar') negotiateCount++;
                else if (p.approvalStatus === 'Rejeitar') rejectedCount++;
            });

            let finalTitle = '';
            let finalMessage = '';
            let finalDetailsHtml = '';

            if (approvedCount === totalProducts) {
                currentViewingPO.overallApprovalStatus = 'Aprovado';
                finalTitle = 'Aprova√ß√£o Conclu√≠da!';
                finalMessage = `Todos os ${totalProducts} produtos do pedido ${currentViewingPO.id} foram APROVADOS pela Ger√™ncia.`;
                finalDetailsHtml = `<p>O pedido foi aprovado e agora o processo segue para a equipe de Compras.</p>`;
            } else if (rejectedCount === totalProducts) {
                currentViewingPO.overallApprovalStatus = 'Rejeitado';
                finalTitle = 'Pedido Rejeitado';
                finalMessage = `Todos os ${totalProducts} produtos do pedido ${currentViewingPO.id} foram REJEITADOS pela Ger√™ncia.`;
                finalDetailsHtml = `<p>O pedido foi rejeitado e o processo ser√° encerrado.</p>`;
            } else if (negotiateCount > 0 || rejectedCount > 0) {
                currentViewingPO.overallApprovalStatus = 'Negociado'; // Altera para Negociado se houver itens para renegociar
                finalTitle = 'Aprova√ß√£o com Pend√™ncias';
                finalMessage = `O pedido ${currentViewingPO.id} foi parcialmente aprovado ou possui itens para renegocia√ß√£o/rejei√ß√£o.`;
                finalDetailsHtml = `
                    <p>${approvedCount} produto(s) aprovado(s).</p>
                    <p>${negotiateCount} produto(s) para renegocia√ß√£o.</p>
                    <p>${rejectedCount} produto(s) rejeitado(s).</p>
                    <p class="mt-4">O pedido retornar√° para a Central de Compras para que as renegocia√ß√µes e/ou rejei√ß√µes sejam tratadas.</p>
                `;
            } else {
                showMessage('Erro', 'Status de aprova√ß√£o inconsistente. Por favor, verifique e tente novamente.', 'error');
                return;
            }

            // Atualiza a data da √∫ltima atualiza√ß√£o da PO e adiciona ao hist√≥rico
            const today = new Date().toISOString().slice(0, 10);
            currentViewingPO.lastUpdateDate = today;
            if (!currentViewingPO.statusHistory) {
                currentViewingPO.statusHistory = [];
            }
            // Adiciona o novo status apenas se for diferente do √∫ltimo
            const lastStatus = currentViewingPO.statusHistory.length > 0 ? currentViewingPO.statusHistory[currentViewingPO.statusHistory.length - 1].status : '';
            if (lastStatus !== currentViewingPO.overallApprovalStatus) {
                currentViewingPO.statusHistory.push({ status: currentViewingPO.overallApprovalStatus, date: today });
            }

            document.getElementById('hongKongFinalTitle').innerText = finalTitle;
            document.getElementById('hongKongFinalMessage').innerText = finalMessage;
            document.getElementById('finalDetailsHK').innerHTML = finalDetailsHtml;

            showScreen('hongKongFinalScreen');

            currentViewingPO = null; // Limpa a PO em visualiza√ß√£o
            synchronizePOs(); // Sincroniza os dados ap√≥s a aprova√ß√£o
        }

        /**
         * Sincroniza o status das POs ap√≥s as a√ß√µes do gestor.
         */
        function synchronizePOs() {
            // Re-renderiza a lista de POs na aba ativa do gestor para refletir as mudan√ßas
            const activeTabButton = document.querySelector('#renatoApprovalMainTabs .tab-button.active');
            if (activeTabButton) {
                switchRenatoApprovalMainTab(activeTabButton.onclick.toString().match(/switchRenatoApprovalMainTab\('(\w+)'\)/)[1]);
            } else {
                switchRenatoApprovalMainTab('pendingApproval'); // Fallback
            }
        }

        /**
         * Abre o modal do fluxograma.
         */
        function openFlowchartModal() {
            document.getElementById('flowchartModal').classList.add('active');
        }

        /**
         * Fecha o modal do fluxograma.
         */
        function closeFlowchartModal() {
            document.getElementById('flowchartModal').classList.remove('active');
        }

        /**
         * Renderiza o conte√∫do da aba "Documentos".
         */
        function renderDocumentsContent() {
            const documentsContentDiv = document.getElementById('documentsContent');
            documentsContentDiv.innerHTML = ''; // Clear previous content

            // Documents are now specific to the currentViewingPO
            const documents = [
                {
                    name: 'Solicita√ß√£o do Cliente',
                    icon: 'üìÑ', // Emoji icon for document
                    type: 'client_request',
                    url: null, // No actual URL, will show message
                    description: 'Documento original da solicita√ß√£o do cliente.'
                },
                {
                    name: 'PO do Compras',
                    icon: 'üõí', // Emoji icon for shopping cart/PO
                    type: 'purchase_order',
                    url: 'uploaded:Modelo PO.pdf', // Path to the uploaded PDF
                    description: 'Ordem de Compra gerada pela equipe de compras.'
                },
                {
                    name: 'PI do Fornecedor',
                    icon: 'üí∞', // Emoji icon for money/invoice
                    type: 'proforma_invoice',
                    url: null, // No actual URL, will show message
                    description: 'Proforma Invoice (Fatura Proforma) enviada pelo fornecedor.'
                }
            ];

            // If a PO is being viewed, display its ID in the document tab header
            const poIdDisplay = currentViewingPO ? currentViewingPO.id : 'N/A';
            // Note: The h2 for "Documentos do Pedido" is now part of the HTML structure of detailedApprovalView
            // We don't need currentDocumentPoIdDisplay anymore as it's handled by currentDetailedParentOrderIdDisplay

            documents.forEach(doc => {
                const card = document.createElement('div');
                card.classList.add('document-card');
                card.innerHTML = `
                    <div class="icon">${doc.icon}</div>
                    <h4>${doc.name}</h4>
                    <p style="font-size: 0.85rem; color: #777; margin-bottom: 15px;">${doc.description}</p>
                    <button class="btn-view" onclick="openDocument('${doc.type}', '${doc.name}', '${doc.url || ''}')">Visualizar</button>
                `;
                documentsContentDiv.appendChild(card);
            });
        }

        /**
         * Abre o modal para visualizar um documento.
         * @param {string} docType Tipo do documento ('client_request', 'purchase_order', 'proforma_invoice').
         * @param {string} docName Nome do documento a ser exibido no t√≠tulo do modal.
         * @param {string} docUrl URL do documento (se houver).
         */
        function openDocument(docType, docName, docUrl) {
            const modal = document.getElementById('documentViewerModal');
            const titleElement = document.getElementById('documentViewerTitle');
            const iframeElement = document.getElementById('documentViewerFrame');
            const messageElement = document.getElementById('documentViewerMessage');

            titleElement.innerText = `Visualizando: ${docName}`;

            if (docUrl) {
                iframeElement.src = docUrl;
                iframeElement.style.display = 'block';
                messageElement.style.display = 'none';
            } else {
                iframeElement.src = '';
                iframeElement.style.display = 'none';
                messageElement.style.display = 'flex'; // Use flex to center message
                messageElement.innerHTML = `<p>O documento "${docName}" seria exibido aqui.</p><p>Para este prot√≥tipo, n√£o h√° um arquivo real dispon√≠vel para este tipo de documento.</p>`;
            }
            modal.classList.add('active');
        }

        /**
         * Fecha o modal de visualiza√ß√£o de documentos.
         */
        function closeDocumentViewerModal() {
            document.getElementById('documentViewerModal').classList.remove('active');
            document.getElementById('documentViewerFrame').src = ''; // Clear iframe src
            document.getElementById('documentViewerMessage').innerHTML = ''; // Clear message
        }

        /**
         * Retorna para a tela de login.
         */
        function backToLogin() {
            logout();
        }

        // Listener para o evento DOMContentLoaded, que √© disparado quando o HTML √© completamente carregado
        document.addEventListener('DOMContentLoaded', () => {
            // Garante que todos os fornecedores nas POs tenham um c√≥digo gerado
            generatedPurchaseOrders.forEach(po => {
                if (po.supplier) {
                    getOrGenerateSupplierCode(po.supplier);
                }
            });

            switchRenatoApprovalMainTab('pendingApproval'); // Ativa a aba "Aguardando Aprova√ß√£o" por padr√£o

            // Listener para o bot√£o de logout
            const renatoLogoutButton = document.getElementById('renatoLogoutButton');
            if (renatoLogoutButton) {
                renatoLogoutButton.addEventListener('click', logout);
            }

            // Listener para o bot√£o de fechar do modal de mensagens
            const messageModalCloseBtn = document.getElementById('messageModalCloseBtn');
            if (messageModalCloseBtn) {
                messageModalCloseBtn.addEventListener('click', () => {
                    document.getElementById('messageModal').classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>
